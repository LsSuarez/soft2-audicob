@model Audicob.Models.PerfilCliente
@{
    ViewData["Title"] = "Consulta de Riesgo del Cliente";
    var riesgo = ViewBag.Riesgo as Audicob.Models.DetalleRiesgo;
}

<div class="container mt-4">
    <h2 class="text-primary mb-4">Consulta de Riesgo del Cliente</h2>

    <form asp-action="ConsultaRiesgo" method="post" class="mb-4">
        <div class="input-group">
            <input type="text" name="dni" class="form-control" placeholder="Ingrese DNI del cliente" required />
            <button type="submit" class="btn btn-success">Consultar Riesgo</button>
        </div>
    </form>

    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger mt-3">@ViewBag.Error</div>
    }

    @if (Model != null)
    {
        <div class="row mt-4">
            <div class="col-md-7">
                <div class="card p-4 shadow-sm">
                    <h5 class="text-secondary mb-3">Datos del Cliente</h5>
                    <p><strong>DNI:</strong> @Model.DocumentoIdentidad</p>
                    <p><strong>Nombre:</strong> @Model.Nombre</p>
                    <p><strong>Teléfono:</strong> @Model.Telefono</p>
                    <p><strong>Correo:</strong> @Model.Correo</p>
                    <p><strong>Dirección:</strong> @Model.Direccion</p>

                    
                </div>
            </div>

            <div class="col-md-5">
                @if (riesgo != null)
                {
                    var color = riesgo.Comentario switch
                    {
                        "Bajo" => "bg-success text-white",
                        "Medio" => "bg-warning text-dark",
                        "Alto" => "bg-danger text-white",
                        _ => "bg-secondary text-white"
                    };

                    <div class="card p-4 shadow-sm @color">
                        <h5>Puntaje Calculado</h5>
                        <h3>@riesgo.Valor</h3>
                        <p><strong>Medida de riesgo:</strong> @riesgo.Comentario</p>
                    </div>
                }
                else
                {
                    <div class="alert alert-secondary">No se encontró medida de riesgo registrada.</div>
                }
            </div>
        </div>
    }
</div>
@if (Model != null)
{
    <div class="mt-3 text-end">
        <button id="btnVerDetalle" class="btn btn-primary">Ver Detalle</button>
        <a asp-action="ExportarRiesgo" asp-route-id="@Model.Id" class="btn btn-danger">Exportar</a>
    </div>

    <!-- Contenedor donde se mostrará el detalle -->
    <div id="detalleRiesgoContainer" class="mt-4"></div>

    @section Scripts {
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $("#btnVerDetalle").on("click", function () {
                const id = @Model.Id;
                const container = $("#detalleRiesgoContainer");

                if (container.is(":visible")) {
                    container.slideUp(300, function() {
                        container.empty();
                    });
                    $("#btnVerDetalle").text("Ver Detalle");
                } else {
                    $.get("@Url.Action("CargarDetalleRiesgo", "Asesor")", { id: id }, function (data) {
                        container.html(data).hide().slideDown(400);
                        $("#btnVerDetalle").text("Ocultar Detalle");
                    });
                }
            });
        </script>
    }
}

