@{
    ViewData["Title"] = "Método de Pago";
}

<div class="container mt-4">
    <h2 class="text-primary mb-4">Seleccionar Método de Pago</h2>

    <div class="d-flex justify-content-around flex-wrap gap-3">
        <!-- Opción 1 -->
        <button class="btn btn-outline-primary btn-lg payment-option" data-method="debito">
            <i class="bi bi-credit-card"></i> Tarjeta de Débito
        </button>

        <!-- Opción 2 -->
        <button class="btn btn-outline-success btn-lg payment-option" data-method="credito">
            <i class="bi bi-credit-card-2-front"></i> Tarjeta de Crédito
        </button>

        <!-- Opción 3 -->
        <button class="btn btn-outline-warning btn-lg payment-option" data-method="transferencia">
            <i class="bi bi-bank"></i> Transferencia Bancaria
        </button>
    </div>

    <!-- Formulario dinámico -->
    <div id="payment-form" class="mt-5">
        <p class="text-muted">Selecciona un método para continuar.</p>
    </div>
</div>
@section Scripts {
<script>
    document.querySelectorAll(".payment-option").forEach(btn => {
        btn.addEventListener("click", () => {
            const method = btn.dataset.method;
            let formHtml = "";

            // Formulario dinámico (solo visual, no se guarda)
            switch (method) {
                case "debito":
                    formHtml = `
                        <h4 class="text-primary">Pago con Tarjeta de Débito</h4>
                        <form id="form-metodo" data-metodo="Tarjeta de Débito">
                            <div class="mb-3">
                                <label class="form-label">Número de tarjeta</label>
                                <input type="text" class="form-control" placeholder="XXXX-XXXX-XXXX-XXXX">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Fecha de vencimiento</label>
                                <input type="month" class="form-control">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Código CVV</label>
                                <input type="text" class="form-control" maxlength="3">
                            </div>
                            <button type="button" class="btn btn-primary" onclick="guardarMetodo(this)">Guardar método</button>
                        </form>`;
                    break;

                case "credito":
                    formHtml = `
                        <h4 class="text-success">Pago con Tarjeta de Crédito</h4>
                        <form id="form-metodo" data-metodo="Tarjeta de Crédito">
                            <div class="mb-3">
                                <label class="form-label">Número de tarjeta</label>
                                <input type="text" class="form-control" placeholder="XXXX-XXXX-XXXX-XXXX">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Titular de la tarjeta</label>
                                <input type="text" class="form-control">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Fecha de vencimiento</label>
                                <input type="month" class="form-control">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Código CVV</label>
                                <input type="text" class="form-control" maxlength="3">
                            </div>
                            <button type="button" class="btn btn-success" onclick="guardarMetodo(this)">Guardar método</button>
                        </form>`;
                    break;

                case "transferencia":
                    formHtml = `
                        <h4 class="text-warning">Pago por Transferencia Bancaria</h4>
                        <form id="form-metodo" data-metodo="Transferencia Bancaria">
                            <div class="mb-3">
                                <label class="form-label">Número de cuenta</label>
                                <input type="text" class="form-control" placeholder="Cuenta bancaria">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Banco</label>
                                <input type="text" class="form-control">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Codigo de operacion</label>
                                <input type="number" class="form-control">
                            </div>
                            <button type="button" class="btn btn-warning" onclick="guardarMetodo(this)">Guardar método</button>
                        </form>`;
                    break;
            }

            document.getElementById("payment-form").innerHTML = formHtml;
        });
    });

    // ===============================
    // FUNCIÓN PARA GUARDAR EL MÉTODO SELECCIONADO
    // ===============================
    async function guardarMetodo(btn) {
        const form = btn.closest("form");
        const metodo = form.dataset.metodo;

        const response = await fetch("/Cliente/GuardarMetodoPago", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: `metodo=${encodeURIComponent(metodo)}`
        });

        if (response.ok) {
            // Redirige al DetalleDeudaTotal después de guardar
            window.location.href = "/Cliente/DetalleDeudaTotal";
        } else {
            alert("❌ Ocurrió un error al guardar el método de pago.");
        }
    }
</script>
}
